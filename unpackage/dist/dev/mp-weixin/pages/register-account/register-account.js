(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/register-account/register-account"],{223:function(e,n,t){"use strict";(function(e){t(5);r(t(3));var n=r(t(224));function r(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(n.default)}).call(this,t(1)["createPage"])},224:function(e,n,t){"use strict";t.r(n);var r=t(225),o=t(227);for(var u in o)"default"!==u&&function(e){t.d(n,e,(function(){return o[e]}))}(u);t(229);var s,a=t(11),i=Object(a["default"])(o["default"],r["render"],r["staticRenderFns"],!1,null,"3c762034",null,!1,r["components"],s);i.options.__file="pages/register-account/register-account.vue",n["default"]=i.exports},225:function(e,n,t){"use strict";t.r(n);var r=t(226);t.d(n,"render",(function(){return r["render"]})),t.d(n,"staticRenderFns",(function(){return r["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return r["recyclableRender"]})),t.d(n,"components",(function(){return r["components"]}))},226:function(e,n,t){"use strict";var r;t.r(n),t.d(n,"render",(function(){return o})),t.d(n,"staticRenderFns",(function(){return s})),t.d(n,"recyclableRender",(function(){return u})),t.d(n,"components",(function(){return r}));try{r={"u-Form":function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u--form/u--form")]).then(t.bind(null,419))},uFormItem:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(t.bind(null,389))},"u-Input":function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u--input/u--input")]).then(t.bind(null,424))}}}catch(a){if(-1===a.message.indexOf("Cannot find module")||-1===a.message.indexOf(".vue"))throw a;console.error(a.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var e=this,n=e.$createElement;e._self._c},u=!1,s=[];o._withStripped=!0},227:function(e,n,t){"use strict";t.r(n);var r=t(228),o=t.n(r);for(var u in r)"default"!==u&&function(e){t.d(n,e,(function(){return r[e]}))}(u);n["default"]=o.a},228:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(t(34));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,n,t,r,o,u,s){try{var a=e[u](s),i=a.value}catch(c){return void t(c)}a.done?n(i):Promise.resolve(i).then(r,o)}function s(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var s=e.apply(n,t);function a(e){u(s,r,o,a,i,"next",e)}function i(e){u(s,r,o,a,i,"throw",e)}a(void 0)}))}}var a={data:function(){return{userInfo:{userName:"",password:"",repeatPassword:"",code:"",nickName:"",photo:""},rules:{userName:[{type:"string",required:!0,message:"请输入账号",trigger:["blur","change"]},{pattern:/^[a-zA-Z]\w{5,17}$/,message:"账号必须字母开头，长度在6~18之间，只能包含字母、数字和下划线"}],password:[{type:"string",required:!0,message:"请输入密码",trigger:["blur","change"]},{pattern:/^.{5,20}$/,message:"密码长度必须为5-20个字符"}],repeatPassword:[{type:"string",required:!0,message:"请再次输入密码",trigger:["blur","change"]},{pattern:/^.{5,20}$/,message:"密码长度必须为5-20个字符"}]}}},methods:{goToLogin:function(){e.navigateBack({delta:1})},submit:function(){var n=this,t=this;this.$refs.userRef.validate().then(function(){var o=s(r.default.mark((function o(u){var a,i,c;return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:a=!0,o.t0=r.default.keys(n.rules);case 2:if((o.t1=o.t0()).done){o.next=10;break}if(i=o.t1.value,n.rules[i][1].pattern.test(n.userInfo[i])){o.next=8;break}return e.$u.toast("".concat(n.rules[i][1].message)),a=!1,o.abrupt("return",!1);case 8:o.next=2;break;case 10:if(!a){o.next=25;break}if(!u||n.userInfo.password!==n.userInfo.repeatPassword){o.next=24;break}return e.showLoading({mask:!0,title:"注册中"}),o.next=15,e.getUserProfile({desc:"用于存储用户数据"});case 15:if(c=o.sent,e.hideLoading(),console.log(c[1]),!c[0]){o.next=21;break}return t.$message.toast("获取失败","text"),o.abrupt("return");case 21:e.login({provider:"weixin",success:function(n){t.userInfo.code=n.code,e.getUserInfo({provider:"weixin",success:function(n){return s(r.default.mark((function n(){var o,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.userInfo.photo=c[1].userInfo.avatarUrl,t.userInfo.nickName=c[1].userInfo.nickName,n.next=4,t.$http.post("/user/register",t.userInfo);case 4:u=n.sent,200==(null===u||void 0===u||null===(o=u.data)||void 0===o?void 0:o.code)?(e.navigateBack({delta:1}),e.$u.toast("注册成功")):e.$u.toast("一个用户只能注册一个账号");case 6:case"end":return n.stop()}}),n)})))()}})}}),o.next=25;break;case 24:n.userInfo.password!==n.userInfo.repeatPassword?e.$u.toast("两次密码不一致"):e.$u.toast("注册失败");case 25:case"end":return o.stop()}}),o)})));return function(e){return o.apply(this,arguments)}}()).catch((function(n){e.$u.toast("注册失败")}))}}};n.default=a}).call(this,t(1)["default"])},229:function(e,n,t){"use strict";t.r(n);var r=t(230),o=t.n(r);for(var u in r)"default"!==u&&function(e){t.d(n,e,(function(){return r[e]}))}(u);n["default"]=o.a},230:function(e,n,t){}},[[223,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/register-account/register-account.js.map